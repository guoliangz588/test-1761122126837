# æ™ºèƒ½å¥åº·é—®è¯¢ç³»ç»Ÿ - MCP Supabase é›†æˆå®ç°æ–‡æ¡£

## ğŸ¯ **é¡¹ç›®æ¦‚è¿°**
æ™ºèƒ½å¥åº·é—®è¯¢ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºåŒAgentæ¶æ„çš„å¥åº·è°ƒæŸ¥é—®å·ç³»ç»Ÿï¼Œé€šè¿‡MCP Supabaseé›†æˆå®ç°å®Œæ•´çš„æ•°æ®æŒä¹…åŒ–å’Œä¼šè¯ç®¡ç†åŠŸèƒ½ã€‚

**ç³»ç»ŸID**: `system_1757299256379_mu0enk1lw`
**ç‰ˆæœ¬**: v5.0.0
**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œå­˜åœ¨æƒé™é…ç½®é—®é¢˜å¾…ä¿®å¤

---

## ğŸ“Š **å½“å‰å®ç°æ¶æ„**

### **åŒAgentæ¶æ„è®¾è®¡**
```
æ™ºèƒ½å¥åº·é—®è¯¢ç³»ç»Ÿ (system_1757299256379_mu0enk1lw)
â”œâ”€â”€ survey-assistant (å¥åº·é—®å·è°ƒæŸ¥åŠ©æ‰‹)
â”‚   â”œâ”€â”€ ç±»å‹: orchestrator  
â”‚   â”œâ”€â”€ åŠŸèƒ½: 12é—®å¥åº·è°ƒæŸ¥å¯¹è¯ç®¡ç†
â”‚   â”œâ”€â”€ èŒè´£: æ•°æ®éªŒè¯ã€JSONç”Ÿæˆã€Agentåè°ƒ
â”‚   â””â”€â”€ âŒ æƒé™é—®é¢˜: toolAccess = []
â””â”€â”€ supabase-agent (æ•°æ®åº“å­˜å‚¨ä»£ç†)
    â”œâ”€â”€ ç±»å‹: tool
    â”œâ”€â”€ åŠŸèƒ½: MCPæ•°æ®åº“æ“ä½œ
    â”œâ”€â”€ èŒè´£: ä¼šè¯ç®¡ç†ã€æ¶ˆæ¯æŒä¹…åŒ–ã€è¿›åº¦å¿«ç…§
    â””â”€â”€ âŒ æƒé™é—®é¢˜: toolAccess = []
```

### **æ ¸å¿ƒè¿æ¥å…³ç³»**
```json
"connections": [
  {
    "from": "survey-assistant",
    "to": "supabase-agent", 
    "type": "tool_call",
    "condition": "éœ€è¦æ•°æ®åº“æ“ä½œæ—¶"
  },
  {
    "from": "survey-assistant",
    "to": "END",
    "type": "completion", 
    "condition": "é—®å·å®Œæˆæ—¶"
  }
]
```

---

## ğŸ—ƒï¸ **æ•°æ®åº“è®¾è®¡è¯¦è§£**

### **è¡¨ç»“æ„è®¾è®¡**

#### **1. chat_sessions (ä¼šè¯è¡¨)**
```typescript
interface ChatSession {
  id: string;                    // ä¸»é”®ï¼šä¼šè¯å”¯ä¸€ID (UUID)
  user_id: string;              // å¤–é”®ï¼šç”¨æˆ·ID (UUID) 
  system_id: string;            // ç³»ç»Ÿæ ‡è¯†ç¬¦ (å¦‚: system_1757299256379_mu0enk1lw)
  title?: string;               // ä¼šè¯æ ‡é¢˜ (å¦‚: "Health Survey Session")
  status: 'active' | 'paused' | 'completed' | 'archived';
  snapshot: Record<string, any>; // ğŸ”¥ æ ¸å¿ƒï¼šé—®å·è¿›åº¦JSONæ•°æ®
  snapshot_updated_at?: string;  // å¿«ç…§æœ€åæ›´æ–°æ—¶é—´
  created_at: string;           // ä¼šè¯åˆ›å»ºæ—¶é—´
  updated_at: string;           // ä¼šè¯æ›´æ–°æ—¶é—´
}
```

#### **2. chat_messages (æ¶ˆæ¯è¡¨)**  
```typescript
interface ChatMessage {
  id: string;                   // ä¸»é”®ï¼šæ¶ˆæ¯å”¯ä¸€ID (UUID)
  session_id: string;          // ğŸ”— å¤–é”®ï¼šå…³è”åˆ°chat_sessions.id
  user_id: string;             // å¤–é”®ï¼šç”¨æˆ·ID (ä¸session.user_idä¸€è‡´)
  agent_id?: string;           // æ¶ˆæ¯å‘é€æ–¹ (survey-assistant/supabase-agent)
  role: 'system' | 'user' | 'assistant' | 'tool';
  content?: string;            // æ¶ˆæ¯æ–‡æœ¬å†…å®¹
  content_json?: Record<string, any>; // JSONæ ¼å¼å†…å®¹ï¼ˆç”¨äºç»“æ„åŒ–æ•°æ®ï¼‰
  client_msg_id?: string;      // å®¢æˆ·ç«¯æ¶ˆæ¯IDï¼ˆå»é‡ç”¨ï¼‰
  seq?: number;                // æ¶ˆæ¯åºå·ï¼ˆè‡ªåŠ¨é€’å¢ï¼‰
  created_at: string;          // æ¶ˆæ¯åˆ›å»ºæ—¶é—´
}
```

### **è¡¨å…³ç³»å›¾**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  chat_sessions  â”‚ 1 â”€â”€â”€â”€N â”‚  chat_messages  â”‚
â”‚                 â”‚         â”‚                 â”‚  
â”‚ â€¢ id (PK)       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â€¢ session_id    â”‚
â”‚ â€¢ user_id       â”‚         â”‚ â€¢ id (PK)       â”‚
â”‚ â€¢ system_id     â”‚         â”‚ â€¢ user_id       â”‚
â”‚ â€¢ snapshot      â”‚         â”‚ â€¢ agent_id      â”‚
â”‚ â€¢ status        â”‚         â”‚ â€¢ role          â”‚
â”‚ â€¢ created_at    â”‚         â”‚ â€¢ content       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â€¢ created_at    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Mockæ•°æ®ç­–ç•¥**
ä¸ºç®€åŒ–å¼€å‘ï¼Œç³»ç»Ÿé‡‡ç”¨ç¡®å®šæ€§UUIDç”Ÿæˆï¼š
```typescript
// å›ºå®šçš„Mockæ•°æ®IDæ¨¡å¼
user_id: generateDeterministicUUID(`${systemId}_mock_user`)
// ç»“æœç¤ºä¾‹: "a1b2c3d4-e5f6-4789-8abc-def012345678"

session_id: generateDeterministicUUID(`${systemId}_mock_session`) 
// ç»“æœç¤ºä¾‹: "f1e2d3c4-b5a6-4978-8cba-fed210987654"
```

### **Snapshotæ•°æ®ç»“æ„**
é—®å·è¿›åº¦å¿«ç…§çš„æ ‡å‡†æ ¼å¼ï¼š
```json
{
  "progress": {
    "total_questions": 12,
    "answered": 3,
    "current_question": 4
  },
  "partial_answers": {
    "age": 25,
    "weight_pounds": 150,
    "height": "5'8\"",
    "sex_assigned_at_birth": "male"
  },
  "question_status": {
    "1": "completed",
    "2": "completed", 
    "3": "completed",
    "4": "pending",
    "5": "pending"
  }
}
```

---

## ğŸ“‹ **12é—®å¥åº·è°ƒæŸ¥æµç¨‹**

### **é—®å·ç»“æ„è®¾è®¡**
| æ­¥éª¤ | åˆ†ç»„ | é—®é¢˜æ•° | é¢„è®¡æ—¶é—´ | å†…å®¹ |
|------|------|---------|----------|------|
| **STEP 1** | Basic Profile | 5é—® | ~30s | å¹´é¾„ã€ä½“é‡ã€èº«é«˜ã€æ€§åˆ«ã€ç§æ— |
| **STEP 2** | Medical History | 3é—® | ~3m | ç–¾ç—…å²ã€æ‰‹æœ¯å²ã€è¿‡æ•å² |  
| **STEP 3** | Medications & Supplements | 2é—® | ~5m | å¤„æ–¹è¯ã€ä¿å¥å“ |
| **STEP 4** | Miscellaneous | 2é—® | ~30s | æ›¿ä»£åŒ»å­¦ã€å¯ç©¿æˆ´è®¾å¤‡ |

### **è¯¦ç»†é—®é¢˜åˆ—è¡¨**

#### **STEP 1: Basic Profile (~30s)**
1. **å¹´é¾„**: "How old are you?"
2. **ä½“é‡**: "What is your weight in pounds? (If in kg, please say so.)"  
3. **èº«é«˜**: "What is your height? (Feet/inches or cm are fine.)"
4. **æ€§åˆ«**: "What was your sex assigned at birth?"
5. **ç§æ—**: "Which ancestries apply to you? (Choose from the list. If 'Other', please specify.)"

#### **STEP 2: Medical History (~3m)**  
6. **ç–¾ç—…å²**: "Please select any conditions from this list. (If 'Other', specify. If 'None', choose only 'None'.)"
7. **æ‰‹æœ¯å²**: "Any surgeries or overnight hospital stays? (List as 'procedure (year)'. Say 'none' if none.)"
8. **è¿‡æ•å²**: "Do you have any allergies? (Choose from allergens list. For each, ask 'What reaction do you have?' If 'Other Allergens', please specify allergen name(s). If 'none', record none.)"

#### **STEP 3: Medications & Supplements (~5m)**
9. **å¤„æ–¹è¯**: "Do you take any medications? (For each: Name, Dose/Strength, Frequency, Purpose. Say 'none' if none.)"
10. **ä¿å¥å“**: "Do you take any supplements? (For each: Name, Dose/Strength, Frequency, Purpose. Say 'none' if none.)"

#### **STEP 4: Miscellaneous (~30s)**
11. **æ›¿ä»£åŒ»å­¦**: "Which complementary & alternative medicine (CAM) fields do you prefer? (Options: Functional Medicine, Ayurveda, Traditional Chinese Medicine, Homeopathy, Hanyak, All. 'All' expands.)"
12. **å¯ç©¿æˆ´è®¾å¤‡**: "Do you use any of these wearable devices? (OURA Ring, Apple Watch, Google Pixel Watch, Fitbit, None.)"

### **æ•°æ®è§„èŒƒåŒ–è§„åˆ™**
- **èº«é«˜å¤„ç†**: æ¥å—ft/inæˆ–cmï¼Œè‡ªåŠ¨è®¡ç®—height_inches_total
- **ä½“é‡è½¬æ¢**: ä¼˜å…ˆä½¿ç”¨ç£…ï¼Œkgè‡ªåŠ¨è½¬æ¢
- **æšä¸¾éªŒè¯**: ä¸¥æ ¼æŒ‰ç…§é¢„å®šä¹‰æšä¸¾åˆ—è¡¨éªŒè¯
- **æ•°æ®æ¸…ç†**: è‡ªåŠ¨å»é‡ã€å»ç©ºæ ¼ã€æ ‡å‡†åŒ–æ ¼å¼

---

## ğŸ› ï¸ **æŠ€æœ¯å®ç°è¯¦æƒ…**

### **MCP Supabaseé›†æˆ**

#### **ç¯å¢ƒå˜é‡é…ç½®**
```env
# Supabaseé…ç½® (å·²é…ç½®)
NEXT_PUBLIC_SUPABASE_URL=https://oqlhmmdachoiuzcbwexs.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ä»£ç†é…ç½® (å·²é…ç½®)
PROXY_ENABLED=true
PROXY_HOST=127.0.0.1
PROXY_PORT=7890
```

#### **MCPæ“ä½œç±»å‹**
```typescript  
type MCPOperationType = 
  | 'create_session'     // åˆ›å»ºæ–°ä¼šè¯
  | 'save_message'       // ä¿å­˜æ¶ˆæ¯
  | 'update_snapshot'    // æ›´æ–°è¿›åº¦å¿«ç…§  
  | 'get_session'        // æŸ¥è¯¢ä¼šè¯ï¼ˆæ”¯æŒinclude_messagesï¼‰
  | 'create_tables'      // åˆå§‹åŒ–æ•°æ®åº“è¡¨
  | 'get_sessions'       // è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨
  | 'delete_session';    // åˆ é™¤ä¼šè¯
```

### **Enhanced Runtime Engineé›†æˆ**

#### **MCPå·¥å…·è°ƒç”¨é€»è¾‘**
```typescript
// æƒé™æ£€æŸ¥ (ç¬¬85è¡Œ)
const hasMCPTools = agentDef.toolAccess.includes('mcp-supabase-operations')

// Schemaæ·»åŠ  (ç¬¬87-91è¡Œ)
if (hasMCPTools) {
  baseSchema.mcpOperations = z.array(z.object({
    type: z.enum(['create_session', 'save_message', 'update_snapshot', /*...*/]),
    data: z.any()
  })).optional()
}

// æ‰§è¡Œå¤„ç† (ç¬¬383-410è¡Œ)
if (result.object.mcpOperations) {
  for (const mcpOp of result.object.mcpOperations) {
    const mcpResult = await mcpSupabaseProxy.executeOperation({
      type: mcpOp.type,
      data: mcpOp.data
    })
    executionResult.mcpToolCalls.push({ operation: mcpOp, result: mcpResult })
  }
}
```

### **å‰ç«¯é›†æˆå®ç°**

#### **è‡ªåŠ¨å¯¹è¯å¯åŠ¨**
```typescript
// chat/page.tsx - è‡ªåŠ¨å¼€å§‹å¯¹è¯åŠŸèƒ½
const [autoStartTriggered, setAutoStartTriggered] = useState(false);

useEffect(() => {
  if (system && !autoStartTriggered && !isLoading && messages.length === 0) {
    setAutoStartTriggered(true);
    console.log('ğŸš€ Auto-starting health survey conversation...');
    
    append({
      role: 'user',
      content: 'AUTO_START'  // è§¦å‘survey-assistantä¸»åŠ¨å¼€å§‹
    });
  }
}, [system, autoStartTriggered, isLoading, messages.length, append]);
```

#### **å›ºå®šSession ID** 
```typescript  
// æ”¯æŒä¼šè¯æ¢å¤çš„å›ºå®šID
const [sessionId] = useState(`${systemId}_mock_session`);
```

---

## âŒ **å½“å‰å­˜åœ¨çš„é—®é¢˜**

### **ğŸ”‘ æ ¸å¿ƒé—®é¢˜ï¼šAgentæƒé™é…ç½®ç¼ºå¤±**

#### **é—®é¢˜è¡¨ç°**
- å‰ç«¯æ­£å¸¸æ˜¾ç¤ºå¥åº·è°ƒæŸ¥å¯¹è¯
- åç«¯æ­£ç¡®å¤„ç†é—®å·é€»è¾‘
- âŒ **Supabaseæ•°æ®åº“ä¸­æ— ä»»ä½•è®°å½•**
- âŒ **ä¼šè¯æ— æ³•æ¢å¤ï¼Œåˆ·æ–°é¡µé¢ä¸¢å¤±å†å²**

#### **æ ¹æœ¬åŸå› **
ä¸¤ä¸ªæ ¸å¿ƒAgentéƒ½ç¼ºå°‘MCPå·¥å…·è®¿é—®æƒé™ï¼š
```json
// å½“å‰é”™è¯¯é…ç½®  
{
  "id": "survey-assistant",
  "toolAccess": []  // âŒ ç©ºæ•°ç»„å¯¼è‡´æ— æ³•è°ƒç”¨MCPæ“ä½œ
}
{
  "id": "supabase-agent", 
  "toolAccess": []  // âŒ ç©ºæ•°ç»„å¯¼è‡´æ— æ³•æ‰§è¡Œæ•°æ®åº“æ“ä½œ
}
```

#### **æŠ€æœ¯åŸç†**
```typescript
// enhanced-runtime-engine.ts:85 æƒé™æ£€æŸ¥é€»è¾‘
const hasMCPTools = agentDef.toolAccess.includes('mcp-supabase-operations')

// ç»“æœ: hasMCPTools = false
// å¯¼è‡´: ä¸æ·»åŠ mcpOperationsåˆ°agentå“åº”schema
// ç»“æœ: agentæ— æ³•ç”Ÿæˆä»»ä½•MCPæ•°æ®åº“æ“ä½œ
```

### **ğŸ”§ è§£å†³æ–¹æ¡ˆ**
```json
// ä¿®å¤åçš„æ­£ç¡®é…ç½®
{
  "id": "survey-assistant",
  "toolAccess": ["mcp-supabase-operations"]  // âœ… æ·»åŠ MCPæƒé™
}
{
  "id": "supabase-agent",
  "toolAccess": ["mcp-supabase-operations"]  // âœ… æ·»åŠ MCPæƒé™  
}
```

---

## âœ… **å·²å®ŒæˆåŠŸèƒ½æ¸…å•**

### **åç«¯å®ç° (100%å®Œæˆ)**
- [x] MCP Supabaseä»£ç†å®Œæ•´å®ç° (`lib/mcp/mcp-proxy.ts`)
- [x] æ•°æ®åº“æ“ä½œæ¥å£å®Œæ•´å®šä¹‰ (`lib/mcp/supabase-tool.ts`)  
- [x] Enhanced Runtime Engine MCPé›†æˆ
- [x] åŒAgentæ¶æ„éƒ¨ç½²å’Œè¿æ¥é…ç½®
- [x] API Routeå¢å¼ºæµå“åº”å¤„ç†
- [x] Mockç”¨æˆ·ç­–ç•¥å’Œç¡®å®šæ€§UUIDç”Ÿæˆ

### **å‰ç«¯å®ç° (100%å®Œæˆ)**  
- [x] èŠå¤©é¡µé¢è‡ªåŠ¨å¯¹è¯å¯åŠ¨
- [x] å›ºå®šSession IDæ”¯æŒä¼šè¯æ¢å¤
- [x] UIæ¶ˆæ¯æ¸²æŸ“å’Œäº¤äº’å¤„ç†
- [x] å“åº”æµè§£æå’Œæ˜¾ç¤º

### **é…ç½®ç®¡ç† (95%å®Œæˆ)**
- [x] Supabaseè¿æ¥é…ç½®
- [x] ç¯å¢ƒå˜é‡å®Œæ•´è®¾ç½®  
- [x] Agentç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–
- [x] ç½‘ç»œä»£ç†é…ç½®
- [ ] **Agentæƒé™é…ç½®ä¿®å¤** (å¾…å®Œæˆ)

---

## ğŸ”„ **æ•°æ®æµç¨‹è®¾è®¡**

### **ç†æƒ³æ•°æ®æµ**
```
ç”¨æˆ·è¾“å…¥ â†’ survey-assistant â†’ é—®å·å¤„ç† â†’ supabase-agent â†’ MCPæ“ä½œ â†’ Supabase
    â†‘                                                     â†“
ç»§ç»­é—®å· â† å‹å¥½å“åº” â† è¿›åº¦ä¿å­˜ â† æ“ä½œç¡®è®¤ â† æ•°æ®åº“å†™å…¥ â† è¡¨æ“ä½œ
```

### **å½“å‰å®é™…æµç¨‹**
```
ç”¨æˆ·è¾“å…¥ â†’ survey-assistant â†’ é—®å·å¤„ç† â†’ âŒæƒé™æ£€æŸ¥å¤±è´¥ â†’ è·³è¿‡MCP
    â†‘                                          â†“
ç»§ç»­é—®å· â† å‹å¥½å“åº” â† âš ï¸æ— æ•°æ®ä¿å­˜ â† æ­£å¸¸è¿”å› â† åªæœ‰å¯¹è¯é€»è¾‘
```

---

## ğŸ“ˆ **æ€§èƒ½å’Œç›‘æ§**

### **æ—¥å¿—ç›‘æ§ç‚¹**
```typescript
// å…³é”®æ—¥å¿—æ ‡è¯†ç¬¦
ğŸ”§ MCP Supabase operation: ${operation.type}     // MCPæ“ä½œå¼€å§‹
âœ… MCP operation result: ${JSON.stringify(...)}  // MCPæ“ä½œå®Œæˆ  
âŒ MCP operation failed: ${error}                // MCPæ“ä½œå¤±è´¥
ğŸ¯ Running agent system for: ${userMessage}      // Agentç³»ç»Ÿå¯åŠ¨
ğŸš€ Auto-starting health survey conversation      // è‡ªåŠ¨å¯¹è¯å¯åŠ¨
```

### **æ€§èƒ½æŒ‡æ ‡**
- **é—®å·å®Œæˆç‡**: ç›®æ ‡ >90%
- **æ•°æ®ä¿å­˜æˆåŠŸç‡**: ç›®æ ‡ 100% (ä¿®å¤å)
- **ä¼šè¯æ¢å¤æˆåŠŸç‡**: ç›®æ ‡ 100% (ä¿®å¤å)
- **å¯¹è¯å“åº”æ—¶é—´**: å½“å‰ 2-8ç§’

---

## ğŸ”® **æœªæ¥æ‰©å±•è®¡åˆ’**

### **çŸ­æœŸç›®æ ‡ (1-2å‘¨)**
1. **ä¿®å¤æƒé™é…ç½®é—®é¢˜** - æ¢å¤æ•°æ®æŒä¹…åŒ–åŠŸèƒ½
2. **æ•°æ®åº“è¡¨ç»“æ„éªŒè¯** - ç¡®ä¿Supabaseè¡¨å·²åˆ›å»º
3. **ç«¯åˆ°ç«¯æµ‹è¯•** - éªŒè¯å®Œæ•´é—®å·æµç¨‹
4. **ä¼šè¯æ¢å¤æµ‹è¯•** - ç¡®ä¿ä¸­æ–­ç»­ä¼ åŠŸèƒ½

### **ä¸­æœŸç›®æ ‡ (1-2ä¸ªæœˆ)**
1. **å¤šç”¨æˆ·æ”¯æŒ** - æ›¿æ¢Mockç”¨æˆ·ä¸ºçœŸå®ç”¨æˆ·ç³»ç»Ÿ
2. **æ•°æ®å¯¼å‡ºåŠŸèƒ½** - æ”¯æŒJSON/CSVå¯¼å‡ºå¥åº·æŠ¥å‘Š  
3. **é«˜çº§åˆ†æ** - å¥åº·é£é™©è¯„ä¼°å’Œå»ºè®®ç”Ÿæˆ
4. **ç§»åŠ¨ç«¯é€‚é…** - å“åº”å¼è®¾è®¡ä¼˜åŒ–

### **é•¿æœŸç›®æ ‡ (3-6ä¸ªæœˆ)**
1. **AIå¥åº·é¡¾é—®** - åŸºäºé—®å·æ•°æ®çš„æ™ºèƒ½å»ºè®®
2. **åŒ»ç–—é›†æˆ** - å¯¹æ¥ç”µå­å¥åº·è®°å½•ç³»ç»Ÿ
3. **å¤šè¯­è¨€æ”¯æŒ** - å›½é™…åŒ–å¥åº·é—®å·
4. **ä¼ä¸šç‰ˆåŠŸèƒ½** - æ‰¹é‡ç”¨æˆ·ç®¡ç†å’ŒæŠ¥å‘Š

---

## ğŸ“š **å¼€å‘æ–‡æ¡£ç´¢å¼•**

### **æ ¸å¿ƒæ–‡ä»¶ç»“æ„**
```
ui-tool-server-standalone/
â”œâ”€â”€ data/agent-systems/
â”‚   â””â”€â”€ system_1757299256379_mu0enk1lw.json    # ç³»ç»Ÿé…ç½®
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â”œâ”€â”€ mcp-proxy.ts                        # MCPä»£ç†å®ç°  
â”‚   â”‚   â””â”€â”€ supabase-tool.ts                    # æ•°æ®åº“æ¥å£å®šä¹‰
â”‚   â””â”€â”€ agents/
â”‚       â””â”€â”€ enhanced-runtime-engine.ts          # Agentè¿è¡Œæ—¶å¼•æ“
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/agent-chat/[systemId]/route.ts     # èŠå¤©APIè·¯ç”±
â”‚   â””â”€â”€ systems/[id]/chat/page.tsx             # èŠå¤©é¡µé¢ç»„ä»¶
â””â”€â”€ .env.local                                  # ç¯å¢ƒå˜é‡é…ç½®
```

### **APIç«¯ç‚¹**
- `POST /api/agent-chat/{systemId}` - ä¸»èŠå¤©æ¥å£
- `POST /api/mcp-proxy` - MCPæ“ä½œä»£ç†
- `GET /api/ui-register` - UIå·¥å…·æ³¨å†Œ

### **å…³é”®é…ç½®**
- **ç³»ç»ŸID**: `system_1757299256379_mu0enk1lw`
- **Mock Session ID**: `system_1757299256379_mu0enk1lw_mock_session`  
- **Supabaseé¡¹ç›®**: `oqlhmmdachoiuzcbwexs.supabase.co`

---

**æœ€åæ›´æ–°**: 2025-09-08
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0  
**ç³»ç»ŸçŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œæƒé™é…ç½®å¾…ä¿®å¤